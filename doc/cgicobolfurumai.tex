COBOLプログラムは通常{\gt(1)オンライン処理,(2)バッチ処理}の２種類があります。
(1)オンライン処理には２種類の方式がありますので、以下の３種類が存在しております。

{\gt (1)オンライン処理 端末占有タイプ}のCOBOLプログラムは起動されると端末を占有して動作し、COBOLプログラム自身が対話形式で動作します。
このプログラムは指定された処理が完全に完了するか、終了の命令が与えられるまで動作し続けます。

{\gt (1')オンライン処理 OLTPタイプ}のCOBOLプログラムは起動時に動作パラメータ(以後メッセージ)を受け付け、後はそのパラメータに従って動作をおこない、結果を戻します。
動作はこのサイクルで完結します。

{\gt (2)バッチ処理}のCOBOLプログラムは起動時に動作パラメータを受け付け、後はそのパラメータに従って動作を行います。端末を占有して動作状況を逐一表示するタイプのものも有りますが、構造としては起動時のパラメータに従って最後まで動作をするだけのものです。

では、COBOL Web APIではどのようになるでしょう？

COBOL Web APIでは上記の{\gt(1')オンライン処理OLTPタイプ,(2)バッチ処理}\footnote{現時点ではバッチ処理の機能はありません。別途バッチスプーラなる機能を追加し、そちらでサポートすることを考えております。}の方式で動作します。


長々と記述しましたが、Webブラウザから送信されるメッセージは、結果の返信によって完結する振る舞いをしなければなりません。

\vspace{1em}
\begin{tabular}{|lllll|}
\hline
クライアント側 & & サーバ側 & & \\
\hline
Webブラウザ & → & Webサーバ & → & プログラム \\
            &    &           &    &  Webブラウザから送信された内容を受信 \\
            &    &           &    &  標準入力と環境変数のどちらかで受信する\\
            &    &           &    &       ↓ \\
            &    &           &    & 　COBOLプログラム実行\\
            &    &           &    &       ↓ \\
            &    &           &    &  処理結果をHTMLで表示、STOP RUN\\
返信内容が表示される& ← &  ←       &←  &  ←表示と同時に表示内容が返信される \\
\hline
\end{tabular}

%もし{\gt (1)オンライン処理 端末占有タイプ}しかイメージがわかないという方(特にパソコンやオフコン上のCOBOLはこちらの概念を使用するものが多いので)はサンプルから見てください。
%きっと理解していただけます。

%次よりWebインタフェースAPIの説明を記述します。

\vspace{1em}

では、ちょっと具体例に触れてみましょう。WebAPIを使うと以下の様なプログラムになります。

\begin{verbatim}
                :          :
      WORKING-STORAGE SECTION.
      01 WEBIF-REC.
        02 FILLER PIC X(20) VALUE 'DATA1'.
                :          :
        02 FILLER PIC X VALUE LOW-VALUE.
        02 FILLER PIC X VALUE LOW-VALUE.
      PROCEDURE DIVISION.
      MAIN-PROC SECTION.
      001.
          CALL 'WEB_GET_QUERY_STRING'.         ←ここでWebブラウザからの情報を取得
          CALL 'WEB_POP' USING WEBIF-REC.      ←COBOLの変数領域にWebブラウザからの
                                                 情報をWEBIF-RECに展開

          処理を行う。                         ←処理を行います

          CALL 'WEB_PUSH' USING WEBIF-REC.      ←Webブラウザ返信用にCOBOL変数領域の
                                                  内容を記憶させる
          CALL 'WEB_SHOW'.                     ←WEB_PUSHで記憶させた変数とHTML
                                                 ファイルを合成して
                                                 Webブラウザへ返信
      999.
            STOP RUN.
\end{verbatim}
      

Webブラウザから送信された内容を元に処理をおこなってWebブラウザへ返信します。

セッションの情報はそこで忘れ去られてしまいますが、次回必要な変数などはWEB\_PUSHで覚えさせておけば
Webブラウザに記憶させるようになっています。

このWebブラウザへ記憶させる方法はhidden属性を付与したtextで記憶させるようになっています。
\footnote{今後クッキーに対応予定です。}

ちょっとは感覚が解ってもらえたのではないでしょうか？

それでは次ページよりWebAPIの解説を記述します。

もっと具体例から理解したいという方は、WebAPIの解説を読み飛ばしてサンプルの章を参照してください。

%\begin{varbatim}
%
%\end{varrbatim}


